#include "CoreSystem.h"
#include "MutationEngine\MutationPipelineFactory.h"
#include "Utils\Debug\Debug.h"

#include <iostream>

CoreSystem::CoreSystem(const MainOptions& mainOptions)
    : m_inputPath(mainOptions.inputPath)
    , m_outputPath(mainOptions.outputPath)
    , m_configPath(mainOptions.configPath)
{
    m_mutationPipeline = MutationPipelineFactory::getInstance().createPipeline(m_configPath);
}

void CoreSystem::run()
{
    LOG_INFO("Starting code-scrambler");

    m_PEFile.reset(new PEFile(m_inputPath));
    m_mutationPipeline->process(m_PEFile);
    m_PEFile->save(m_outputPath);
}