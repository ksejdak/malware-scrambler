#ifndef ENCRYPTIONENGINE_H
#define ENCRYPTIONENGINE_H

#include "IMutationEngine.h"

#include <vector>
#include <string>
#include <boost\property_tree\ptree.hpp>
#include <boost\filesystem.hpp>

class EncryptionEngine : public IMutationEngine
{
public:
    /// @brief Constructor
    /// @param [in] engineTree      property tree describing engine
    EncryptionEngine(const boost::property_tree::ptree& engineTree);

    /// @brief Virtual destructor
    virtual ~EncryptionEngine() {}

    /// @see IMutationEngine::mutate
    virtual void mutate(std::shared_ptr<PEFile> PE, std::map<std::string, std::string>& context);

private:
    /// @see IMutationEngine::initRequiredSubnodes
    virtual std::vector<std::string>& getRequiredSubnodes();

    /// @brief Preprocesses code template by replacing wildcards with values computed basing on current code section
    /// @param [in] codeSize        size of code that will be decoded
    void preprocessCodeTemplate(size_t codeSize);

private:
    boost::filesystem::path m_codeTemplatePath;
    boost::filesystem::path m_processedCodeTemplatePath;
    std::string m_assembler;
    std::string m_params;
    std::string m_decoderKey;
};

#endif