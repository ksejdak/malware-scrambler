from Utils.Logger import Logger
from API.RequestHandler import RequestHandler

import os
import sys
import requests
import json

def main(argv = None):
    if(argv is None):
        argv = sys.argv

    Logger.initLogger()
    log = Logger.getLogger()

    if(len(argv) != 3):
        log.error("malware directory not specified!")
        log.info("usage: VirusTotalAPI <directory>")
        return 1

    requestType = argv[1]
    requestHandler = RequestHandler()
    try:
        for file in os.listdir(argv[2]):
            ret = requestHandler.process(requestType, file)
            if(ret == True):
                log.info("Scanning file SUCCESS")
            else:
                log.error("Scanning file FAILED")
    except IOError:
        log.error("VirusTotal API terminated")
    except KeyboardInterrupt:
        log.info("VirusTotal API terminated")

if(__name__ == '__main__'):
    main()