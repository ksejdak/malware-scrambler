from Utils.Logger import Logger
from Utils.Settings import SCAN_FILE_URL, RESCAN_FILE_URL, GET_REPORT_URL, PUBLIC_API_KEY

class RequestHandler(object):

    def __init__(self):
        self.__log = Logger.getLogger()

        # create functions mapping
        self.__handlers = {
			"scan"      : self.__scanFile,
			"rescan"    : self.__rescanFile,
			"report"    : self.__getScanReport,
		}

    def process(requestType, filename):
        requestHandler = self.__handlers[requestType]
        return requestHandler(filename)

    def __scanFile(self, filename):
        url = SCAN_FILE_URL

        try:
            file = open(filename, "rb")
            files = {"file": file}
            values = {"apikey": PUBLIC_API_KEY}
            response = requests.post(url, values, files = files)
            responseJSON = response.json()
            print responseJSON
            return True

        except:
            log.error("Could not open file")
            return False
    
    def __rescanFile(self, filename):
        url = RESCAN_FILE_URL
        return True

    def __getScanReport(self, filename):
        url = GET_REPORT_URL
        return True