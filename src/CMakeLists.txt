# output settings
set(EXECUTABLE_OUTPUT_PATH ${CMAKE_HOME_DIRECTORY}/bin/malware-scrambler)
set(LIBRARY_OUTPUT_PATH ${CMAKE_HOME_DIRECTORY}/lib)

# main executable target
add_executable(${APP_TARGET_NAME} main.cpp MalwareScrambler.cpp)
set_property(TARGET ${APP_TARGET_NAME} PROPERTY FOLDER Executables)
set_property(TARGET ${APP_TARGET_NAME} PROPERTY OUTPUT_NAME ${APP_NAME})

# shared libary target
add_library(${LIBRARY_TARGET_NAME} SHARED MalwareScrambler.cpp)
set_property(TARGET ${LIBRARY_TARGET_NAME} PROPERTY FOLDER Executables)
set_property(TARGET ${LIBRARY_TARGET_NAME} PROPERTY OUTPUT_NAME_DEBUG ${LIBRARY_NAME}d)
set_property(TARGET ${LIBRARY_TARGET_NAME} PROPERTY OUTPUT_NAME_RELEASE ${LIBRARY_NAME})

# component targets
set(EXCLUDED_COMPONENTS "GUI" "VirusTotal")

GetSubdirectories(SUBDIR_LIST ${CMAKE_CURRENT_SOURCE_DIR})
foreach(COMPONENT ${SUBDIR_LIST})
    list(FIND EXCLUDED_COMPONENTS ${COMPONENT} EXCLUDED_INDEX)
    if(${EXCLUDED_INDEX} EQUAL -1)
        # not found in excluded components list, so include
        add_subdirectory(${COMPONENT})
        target_link_libraries(${APP_TARGET_NAME} ${COMPONENT})
        target_link_libraries(${LIBRARY_TARGET_NAME} ${COMPONENT})
    endif()
endforeach()

# linking external libraries
target_link_libraries(${APP_TARGET_NAME} ${Boost_LIBRARIES})
target_link_libraries(${LIBRARY_TARGET_NAME} ${Boost_LIBRARIES})