#include "ResourcesStructures.h"
#include "ResourceDirectory.h"

IResourceComponent::IResourceComponent(std::shared_ptr<PESection> section, PIMAGE_RESOURCE_DIRECTORY_ENTRY entry)
    : m_id(0)
    , m_sectionRVA(section->getSectionHeader()->VirtualAddress)
{
    m_entry = entry;
    if(m_entry)
    {
        if(isNamed())
        {
            m_string = reinterpret_cast<PIMAGE_RESOURCE_DIRECTORY_STRING>(section->getData()->data() + m_entry->NameOffset);
            m_componentName = m_string->NameString;
        }
        else
        {
            m_id = m_entry->Id;
            m_componentName = std::to_string(m_id);
        }
    }
    else
        m_componentName = "ROOT";
}

bool IResourceComponent::isNamed()
{
    return (bool) m_entry->NameIsString;
}

void IResourceComponent::setParent(std::shared_ptr<ResourceDirectory> parentComponent)
{
    m_parentComponent = parentComponent;
}

std::string IResourceComponent::getComponentName()
{
    return m_componentName;
}

unsigned long IResourceComponent::getId()
{
    return m_id;
}